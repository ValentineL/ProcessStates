<script>

    const sleep = (ms) => {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    const getProcessingPage = async () => {

        // modify the data array by providing states and optional error codes within the same object
        // e.g. states can be 'processing', 'error', 'success' and error codes 'NO_STOCK', 'INCORRECT_DETAILS', null, undefined

        const data = [{ state: 'processing' }, { state: 'error', errorCode: 'NO_STOCK' }];

        if (data.length) {
            for (let i = 0; i < data.length; i++) {
                if (data[i].state === 'processing' && i < data.length - 1) {
                    alert('Next state');
                    await sleep(2000);
                }
                if (data[i].state === 'error') {
                    if (data[i].errorCode === null || data[i].errorCode === undefined) {
                        alert('Error page');
                        return { title: 'Error page', message: null };
                    }
                    if (data[i].errorCode === 'NO_STOCK') {
                        alert('No stock');
                        return { title: 'Error page', message: 'No stock has been found' };
                    }
                    if (data[i].errorCode === 'INCORRECT_DETAILS') {
                        alert('Incorrect details');
                        return { title: 'Error page', message: 'Incorrect details have been entered' };
                    }
                }
                if (data[i].state === 'success') {
                    alert('Success');
                    return { title: 'Order complete', message: null };
                }
            }
        }
    }

</script>

<input type=button onClick="getProcessingPage()" value="Run script">